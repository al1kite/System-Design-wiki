# Estimation

추론, 시스템 디자인은 시스템 요구 사항에 맞게 결정이 된다. 
요구 사항이란 보통 어느 정도 요청이 들어오는지, 요청마다 사용하는 메모리가 어느 정도일지, 
어느 정도의 가용성이 필요한지, 어느 정도 엄밀한 트랜젝션이 필요한지, 여러 측면이 있다.

이러한 요구사항을 기반으로 정확하게 예측하며 시스템을 개발하는데 도움을 줄 수 있는 숫자에 대해 알아볼 예정.

### 2의 제곱 
시스템 개발 전 2의 제곱(배수) 값에 익숙해지는 것이 중요하다.
용량을 표기하는 기준이 2의 10승 단위로 변경된다.

| 지수 | 근사값  | 이름      |
|----|------|---------|
| 10 | 1천   | 1 킬로바이트 |
| 20 | 100만 | 1 메가바이트 |
| 30 | 10억  | 1 기가바이트 |
| 40 | 1조   | 1 테라바이트 |

### 메모리 사용량
이것과 더해서 언어별 특수한 메모리 사용량에 대해서도 대략적으로 알아두면 좋다.
예시로 Go 언어에서는 Goroutine 을 동시성을 처리하기 위해 사용하게 된다.
예를 들어 어떤 HTTP 서버에서 고루틴을 갖고 요청을 처리한다고 가정하면 요청이 동시에 몰리게 되면
Goroutine 이 여러 개 사용하는 효과를 갖게 된다.
초기 스택으로 Goroutine 하나 당 2KB 정도를 소비하게 되어있다 (경량 스레드)
그래서 초당 100명의 요청이 들어오면 최소 0.2MB 가 고정으로 사용되며 고루틴 스탯 내에서 더 많은 용량을 사용하게 되면
더 커질 수도 있다. 이런 식으로 언어 별로 특수한 어느 정도 양을 메모리를 사용하고 있는지 알고 있는게 개발하는 상황에서 더 좋다.

### 시스템 가용성
이 다음이 시스템 가용성을 표기하는 기준들인데, 특정한 요구사항을 만족하는 서비스 합의 수준인 SLA (Service Level Agree)
라고 불리는게 이는데, 보통 클라우드 서비스 혹은 SaaS를 사용할 때 가용성 수준이라든지 응답 속도 등으로 접할 수 있다.

| SLA     | 일 기즌   | 주 기준   | 월 기준   | 연 기준  |
|---------|--------|--------|--------|-------|
| 99%     | 14.40분 | 1.68시간 | 7.31시간 | 3.65일 |
| 99.99%  | 8.64초  | 1.01분  | 4.38분  | 52.60분 |
| 99.999% | 864밀리초 | 6.05초  | 26.30초 | 5.26분 |

예를 들어 SLA 가 99%일 경우 일기준 14.4분, 주기준 1.68시간, 월기준 7.31시간, 연기준 3.65일 정도 장애가 발생할 수 있음을 의미한다.

### 컴퓨터 자원의 속도 비교
컴퓨터 자원의 속도 역시 시스템을 디자인할 때, 혹은 구체적으로 코드를 작성할 때 최적화를 위해 아주 중요한 역할을 한다.
많은 DB 도서를 보면 제일 앞장에 메모리 Read에 비해 디스트 Read가 얼마나 느린지에 대한 설명을 쉽게 나오는데, 이런 뻔한 얘기가 계속 나오는 이유는
사실 DB에서 디스크 읽기를 줄이는 것이 얼마나 중요한지를 설명하는 장이다.

메모리를 100만번 접근하는 것이 디스크를 한 번 접근하는 것보다 빠르다. 코드를 짜다보면 과도해보이는 반복문에 멈칫하는 순간이 올 수 있는데
이에 비해 디스크 Read를 한 번 더 하는 게 속도를 훨씬 더 느리게 만들 수 있음을 의미한다.

직관적인 느낌과 다르게 코드를 좀 더 효율적으로 동작시킬 수 있는 방법을 알 수 있는 것.

L1 캐시 같은 경우 가장 빠르다. 이런 거 알면 좋고.. 우리가 일반적으로 접하는 디스크 Read 같은 거, SSD Read
순차 읽기, Seek 연산 같은게 얼마나 걸리는지 대략적으로 알아두고 이게 특히 다른 읽기와 얼마나 차이나는지
이런 걸 같이 고민해두면 좋을 듯.

| 연산 명 & 기준     | 속도       |
|---------------|----------|
| L1 캐시         | 1 나노초    | 
| Mutex Operation | 17 나노초   | 
| 일반 네트워크의 2KB 전송 | 44 나노초   | 
| 메인 메모리 참조     | 100 나노초  | 
| 1 마이크로초       | 1000 나노초 | 
| 메모리에서 1MB 순차 읽기 | 3 마이크로초  | 
| SSD Seek 연산   | 16 마이크로초 | 
| SSD 1MB 순차 앍가 | 49 마이크로초 |
| 데이터 센터 내의 패킷 왕복 지연 | 500 마이크로초 |
| 디스크 1MB 순차 읽기 | 825 마이크로초 |
| 1 밀리초 | 1000 마이크로초 |
| 디스크 Seek 연산 | 2 밀리초 |
| 지구 반대편 패킷 왕복 시간 | 150 밀리초 |

- https://colin-scott.github.io/personal_website/research/interactive_latency.html
- https://highscalability.com/google-pro-tip-use-back-of-the-envelope-calculations-to-choo/

